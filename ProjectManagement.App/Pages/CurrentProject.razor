@page "/currentproject/{currentprojectid:guid}"
@using Services
@using Contracts
@using ViewModels
@inject NavigationManager NavigationManager
@inject IProjectDataService ProjectDataService

@if (Projects == null)
{
    <p>Loading tasks...</p>
}
else
{
    <button class="btn btn-success mb-2" @onclick="() => AddTask(CurrentProjectId)">Add task</button>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col">Task name</th>
                <th scope="col">Description</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var proj in Projects)
            {
                if (proj.ProjectId == CurrentProjectId)
                {
                    foreach (var task in proj.Tasks)
                    {
                        taskAmount++;
                        <tr>
                            <th scope="row"></th>
                            <td>
                                @task.TaskName
                            </td>
                            <td>
                                @task.Description
                            </td>
                            <td>
                                <button class="btn btn-outline-success" @onclick="() => UpdateTask(task.TaskId)">Edit</button>
                            </td>
                        </tr>
                    }
                }
            }
        </tbody>
    </table>
}




@code {
    [Parameter]
    public Guid? CurrentProjectId { get; set; }

    public ICollection<ProjectTaskViewModel> Projects { get; set; }
    private int taskAmount = 0;

    protected void AddTask(Guid? id)
    {
        var projectId = id.ToString();
        NavigationManager.NavigateTo("/addtask/" + projectId);
    }
    protected void UpdateTask(Guid id)
    {
        var taskid = id.ToString();
        var projId = CurrentProjectId.ToString();
        NavigationManager.NavigateTo("/updatetask/" + taskid);
    }

    protected override async System.Threading.Tasks.Task OnInitializedAsync()
    {
        Projects = await ProjectDataService.GetAllProjectsWithTasks();
    }
}
